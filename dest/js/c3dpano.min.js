"use strict";var path;function Ceramic3DPanorama(e,r,t){function a(e){var L=e;"string"==typeof L&&(L=document.getElementById(L));var r,t,a,n,o,w,I,M,B,b,F,x,C,S,y,X,D,N,Y,O,G=L.getContext("webgl")||L.getContext("experimental-webgl");if(!s)var s="undefined"!=typeof Float32Array?Float32Array:Array;var H,j,W,V,q,K=new s(16),Z=new s(9),k=Math.PI/300,z=2*Math.PI,$=Math.PI/2;function J(e,r){I=e,M=r,L.width=e,L.height=r,G.viewport(0,0,e,r),W=!(D=!0),q=V=0}function i(){var e,r,t,a,n,o,i,f,c,u,s,l,E,d,v,m,g,T,_,p,R,A,h,U,P;w&&(L.scrollWidth==I&&L.scrollHeight==M||(J(L.scrollWidth,L.scrollHeight),Y=O-1),!W||0==V&&0==q||((H+=V*k)>z?H-=z:H<=0&&(H+=z),$<(j+=q*k)?j=$:j<-$&&(j=-$),D=!(q=V=0)),Y!=O&&(Y=O,D=!0,c=I,u=M,s=Math.PI/3-O/10,E=10,h=c/u,U=(l=.05)*Math.tan(s/2),p=1/((v=P=U*h)-(d=-P)),R=1/((g=U)-(m=-U)),A=1/((T=l)-(_=E)),K[0]=2*T*p,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=2*T*R,K[6]=0,K[7]=0,K[8]=(d+v)*p,K[9]=(m+g)*R,K[10]=(T+_)*A,K[11]=-1,K[12]=0,K[13]=0,K[14]=T*_*2*A,K[15]=0),D&&(D=!1,e=Math.cos(H),r=Math.sin(H),n=e*(t=Math.cos(j)),o=r*t,i=e*(a=Math.sin(j)),f=r*a,Z[0]=e,Z[1]=f,Z[2]=-o,Z[3]=0,Z[4]=t,Z[5]=a,Z[6]=r,Z[7]=-i,Z[8]=n,G.clear(G.COLOR_BUFFER_BIT|G.DEPTH_BUFFER_BIT),G.useProgram(b),G.bindBuffer(G.ARRAY_BUFFER,X),G.vertexAttribPointer(y,3,G.FLOAT,!1,0,0),G.uniformMatrix3fv(F,!1,Z),G.uniformMatrix4fv(x,!1,K),G.uniform1f(S,N),G.activeTexture(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,B),G.uniform1i(C,0),G.drawArrays(G.TRIANGLES,0,36)))}function f(e,r){var t=G.createShader(G.VERTEX_SHADER);if(G.shaderSource(t,e),G.compileShader(t),G.getShaderParameter(t,G.COMPILE_STATUS)){var a=G.createShader(G.FRAGMENT_SHADER);if(G.shaderSource(a,r),G.compileShader(a),G.getShaderParameter(a,G.COMPILE_STATUS)){var n=G.createProgram();if(G.attachShader(n,t),G.attachShader(n,a),G.linkProgram(n),G.getProgramParameter(n,G.LINK_STATUS))return n;console.error(G.getProgramInfoLog(n))}else console.error(G.getShaderInfoLog(a))}else console.error(G.getShaderInfoLog(t))}function c(e){B=function(e){var r=G.createTexture();G.bindTexture(G.TEXTURE_CUBE_MAP,r),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,!0);for(var t=0;t<6;t++)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,G.RGBA,G.RGBA,G.UNSIGNED_BYTE,e[t]);return G.generateMipmap(G.TEXTURE_CUBE_MAP),G.getError()==G.NO_ERROR?G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR_MIPMAP_LINEAR):G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR),G.bindTexture(G.TEXTURE_CUBE_MAP,null),r}(e),D=!(w=!0),i()}function u(){w||(L.scrollWidth==I&&L.scrollHeight==M||J(L.scrollWidth,L.scrollHeight),D&&(D=!1,G.clear(G.COLOR_BUFFER_BIT|G.DEPTH_BUFFER_BIT),G.useProgram(o),G.bindBuffer(G.ARRAY_BUFFER,n),G.vertexAttribPointer(a,3,G.FLOAT,!1,0,0),G.uniform1f(t,r),G.drawArrays(G.TRIANGLES,0,6)))}return G.clearColor(1,1,1,1),o=f("attribute vec3 a; varying vec2 v; void main() {v = a.xy; gl_Position = vec4(a, 1.0);}","precision mediump float; uniform float perc; varying vec2 v; void main() {if (abs(v.x) > 0.4 || abs(v.y) > 0.05) discard;if ((v.x + 0.4)/0.8 < perc) gl_FragColor = vec4(1.0,  0.0,  0.0,  1.0); else gl_FragColor = vec4(0.7, 0.7, 0.7, 1.0);}"),t=G.getUniformLocation(o,"perc"),a=G.getAttribLocation(o,"a"),G.enableVertexAttribArray(a),n=G.createBuffer(),G.bindBuffer(G.ARRAY_BUFFER,n),G.bufferData(G.ARRAY_BUFFER,new s([-1,-1,0,-1,1,0,1,-1,0,1,1,0,-1,1,0,1,-1,0]),G.STATIC_DRAW),b=f("uniform mat3 vm; uniform mat4 pm; attribute vec3 a; varying vec3 v; void main() {v = a; gl_Position = pm * vec4(vm * a, 1.0);}","precision mediump float; uniform samplerCube t; uniform float Ysign; varying vec3 v; void main() {gl_FragColor = textureCube(t, vec3(v.x, Ysign * v.z, -v.y));}"),F=G.getUniformLocation(b,"vm"),x=G.getUniformLocation(b,"pm"),C=G.getUniformLocation(b,"t"),S=G.getUniformLocation(b,"Ysign"),y=G.getAttribLocation(b,"a"),G.enableVertexAttribArray(y),X=G.createBuffer(),G.bindBuffer(G.ARRAY_BUFFER,X),G.bufferData(G.ARRAY_BUFFER,function(){for(var e=new s(108),r=new s(3),t=new s(3),a=0,n=0;n<3;n++){r[0]=n,r[1]=(n+1)%3,r[2]=(n+2)%3;for(var o=-1;o<2;o+=2)for(var i=0,f=-1;f<2;f+=2)for(var c=-1;c<2;c+=2){t[r[0]]=o,t[r[1]]=f,t[r[2]]=c;for(var u=0;u<3;u++)e[3*a+u]=t[u];if(1==i||2==i)for(u=0;u<3;u++)e[3*(a+2)+u]=t[u];2==i&&(a+=2),a++,i++}}return e}(),G.STATIC_DRAW),function(){L.onmousedown=function(e){return w&&1==e.which&&(W=!0),e.preventDefault(),!1},L.addEventListener("touchstart",function(e){if(!w)return e.preventDefault(),!1;W=!0;var r=e.changedTouches[0],t=(r.pageX-L.offsetLeft)/3,a=(r.pageY-L.offsetTop)/3;return n=t,o=a,e.preventDefault(),!1},!1),window.addEventListener("mouseup",function(e){return!!w&&(1==e.which&&(W=!1),!1)},!1),window.addEventListener("touchend",function(e){},!1),L.ontouchend=function(e){return e.preventDefault(),!1};var n=0,o=0;window.addEventListener("mousemove",function(e){if(!w)return!1;var r=e.pageX-L.offsetLeft,t=e.pageY-L.offsetTop;return V=r-n,q=t-o,n=r,o=t,i(),!1},!1),window.addEventListener("touchmove",function(e){if(!w)return e.preventDefault(),!1;var r=e.changedTouches[0],t=(r.pageX-L.offsetLeft)/3,a=(r.pageY-L.offsetTop)/3;return V=t-n,q=a-o,n=t,o=a,i(),e.preventDefault(),!1},!1),L.ontouchmove=function(e){return e.preventDefault(),!1},L.onwheel=function(e){return!!w&&(0<e.wheelDelta?O=Math.min(O+1,6):e.wheelDelta<0&&(O=Math.max(O-1,-10)),e.deltaY<0?O=Math.min(O+1,6):0<e.deltaY&&(O=Math.max(O-1,-10)),i(),!1)}}(),{reload:function(e){r=0,D=!(w=!1),N=1==e.cameraVersion?1:-1,W=!(Y=-100),q=V=j=H=O=0,G.deleteTexture(B),u(),function(n,e,r,o){var t=void 0!==(new window.XMLHttpRequest).onprogress,a=n.length,i=a,f=new Array(a),c=new Array(a),u=new Array(a),s=0,l=0,E=a;if(!t){for(var d=0;d<a;d++)c[d]=0,u[d]=1;l=a,E=0}function v(){0==--i&&r(f)}function m(r){return function(e){isNaN(u[r])&&0<e.total&&(u[r]=e.total,c[r]=0,l+=e.total,E--),!isNaN(u[r])&&e.loaded>c[r]&&(s+=e.loaded-c[r],c[r]=e.loaded,0==E&&o(s/l))}}function g(t,a){return function(){if(isNaN(u[t])?E--:u[t]>c[t]&&(s+=u[t]-c[t],c[t]=u[t],0==E&&o(s/l)),200<=this.status&&this.status<400)if(a){var e=this.getAllResponseHeaders().match(/^Content-Type\:\s*(.*?)$/im)[1]||"image/png",r=new Blob([this.response],{type:e});f[t]=new Image,f[t].onload=v,f[t].src=window.URL.createObjectURL(r)}else f[t]=this.response,v();else console.error("Unable to load file "+n[t]+"!"),v()}}for(d=0;d<a;d++){var T=n[d],_=T.substr(T.lastIndexOf(".")),p=".jpg"==_||".bmp"==_||".png"==_,R=p||".bin"==_;if(!t&&p)f[d]=new Image,f[d].onload=function(){o(++s/l),v()},f[d].src=T;else{var A=new XMLHttpRequest;A.onload=g(d,p),t&&(A.onprogress=m(d)),A.open("GET",T,!0),R&&(A.responseType="arraybuffer"),A.send()}}}(e.panorams[0],0,c,function(e){r=e,D=!0,u()})},redraw:function(){i()}}}function n(){return!1}var o,i,f;"string"==typeof(i=(o={canvas:e,panorams:[[t+"/+X.jpg",t+"/-X.jpg",t+"/+Y.jpg",t+"/-Y.jpg",t+"/+Z.jpg",t+"/-Z.jpg"]]}).canvas)&&(i=document.getElementById(i)),i.c3dpano=a(i),i.onselectstart=n,i.ondragstart=n,i.c3dpano.reload(((f=new Object).panorams=o.panorams,f.cameraVersion=o.cameraVersion,f))}
//# sourceMappingURL=maps/c3dpano.min.js.map
